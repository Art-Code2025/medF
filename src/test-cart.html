<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ù„Ø©</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .cart-info { 
            background: #f0f0f0; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px;
            border: 2px solid #ddd;
        }
        .big-text { 
            font-size: 24px; 
            font-weight: bold; 
            color: #e11d48;
        }
        button {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #059669; }
    </style>
</head>
<body>
    <h1>ğŸ›’ Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³Ù„Ø©</h1>
    
    <div class="cart-info">
        <h2>ğŸ’° Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
        <div class="big-text">
            Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: <span id="cart-count">0</span><br>
            Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: <span id="cart-value">0</span> Ø±.Ø³
        </div>
    </div>

    <div>
        <button onclick="fetchCartFromAPI()">ğŸ“¡ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ù„Ø© Ù…Ù† API</button>
        <button onclick="updateLocalStorage()">ğŸ’¾ ØªØ­Ø¯ÙŠØ« localStorage</button>
        <button onclick="clearCart()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
        <button onclick="addTestProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ</button>
    </div>

    <div class="cart-info">
        <h3>ğŸ” localStorage Values:</h3>
        <div id="localStorage-values"></div>
    </div>

    <div class="cart-info">
        <h3>ğŸ“Š API Response:</h3>
        <pre id="api-response"></pre>
    </div>

    <script>
        function updateDisplay() {
            const count = localStorage.getItem('lastCartCount') || '0';
            const value = localStorage.getItem('lastCartValue') || '0';
            
            document.getElementById('cart-count').textContent = count;
            document.getElementById('cart-value').textContent = parseFloat(value).toFixed(2);
            
            document.getElementById('localStorage-values').innerHTML = `
                lastCartCount: ${count}<br>
                lastCartValue: ${value}<br>
                lastWishlistCount: ${localStorage.getItem('lastWishlistCount') || '0'}
            `;
        }

        async function fetchCartFromAPI() {
            try {
                const response = await fetch('http://localhost:3001/api/cart?userId=guest');
                const cartData = await response.json();
                
                document.getElementById('api-response').textContent = JSON.stringify(cartData, null, 2);
                
                if (Array.isArray(cartData)) {
                    const totalCount = cartData.reduce((sum, item) => sum + item.quantity, 0);
                    const totalValue = cartData.reduce((sum, item) => sum + (item.price || item.product?.price || 0) * item.quantity, 0);
                    
                    localStorage.setItem('lastCartCount', totalCount.toString());
                    localStorage.setItem('lastCartValue', totalValue.toString());
                    
                    updateDisplay();
                    alert(`âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«: ${totalCount} Ù…Ù†ØªØ¬ØŒ ${totalValue.toFixed(2)} Ø±.Ø³`);
                }
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£: ' + error.message);
            }
        }

        function updateLocalStorage() {
            localStorage.setItem('lastCartCount', '3');
            localStorage.setItem('lastCartValue', '580');
            updateDisplay();
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« localStorage ÙŠØ¯ÙˆÙŠØ§Ù‹');
        }

        function clearCart() {
            localStorage.setItem('lastCartCount', '0');
            localStorage.setItem('lastCartValue', '0');
            updateDisplay();
            alert('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©');
        }

        async function addTestProduct() {
            try {
                const response = await fetch('http://localhost:3001/api/cart', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        productId: Math.floor(Math.random() * 100),
                        quantity: 1,
                        userId: 'guest',
                        productName: 'Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ',
                        price: 50
                    })
                });
                
                if (response.ok) {
                    alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ ØªØ¬Ø±ÙŠØ¨ÙŠ');
                    fetchCartFromAPI();
                } else {
                    alert('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬');
                }
            } catch (error) {
                alert('âŒ Ø®Ø·Ø£: ' + error.message);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        setInterval(updateDisplay, 1000);
        
        // ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        updateDisplay();
        fetchCartFromAPI();
    </script>
</body>
</html> 